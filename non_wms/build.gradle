def inBaseDir = '/home/bjsvwjek/code/pipelines/api_webgisclient/sql2json/templates'

def outBaseDir = projectDir.getParent().toString() + '/.gitignored/other_data'
def baseCmd = [
    'java', '-Dorg.slf4j.simpleLogger.defaultLogLevel=info', '-jar', projectDir.getParent().toString() + '/.gitignored/pipe_bin/sql2json/sql2json.jar',
    '-c', 'jdbc:postgresql://localhost:5433/simi',
    '-u', 'postgres', '-p', 'postgres'
]

task _dprodPerm(type:Copy){
    from projectDir.getParent().toString() + '/.gitignored/pipe_data/multi/permissions.json'
    into outBaseDir + '/dataprod'
}

task dprodJson(type:Exec, dependsOn:_dprodPerm){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/dataproduct-service/template.json',
        '-o',  outBaseDir + '/dataprod/dataproductConfig.json', 
        '-s', 'https://raw.githubusercontent.com/qwc-services/sogis-dataproduct-service/master/schemas/sogis-dataproduct-service.json'
        ]
}

task searchJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/search-service/template.json',
        '-o',  outBaseDir + '/search/searchConfig.json', 
        '-s', 'https://raw.githubusercontent.com/qwc-services/qwc-fulltext-search-service/master/schemas/qwc-search-service.json'
        ]
}

task mapJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/map-viewer/template.json',
        '-o',  outBaseDir + '/map-viewer/mapViewerConfig.json', 
        '-s', 'https://github.com/qwc-services/qwc-map-viewer/raw/master/schemas/qwc-map-viewer.json'
        ]
}

task cccJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/ccc-config/template.json',
        '-o',  outBaseDir + '/ccc/cccConfig.json', 
        '-s', 'https://github.com/qwc-services/sogis-ccc-config/raw/master/schemas/sogis-ccc-config.json'
        ]
}

task down(type:Exec){
    commandLine 'docker-compose','down'
    ignoreExitValue true
}

task printJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/print-service/_dev_template.json',
        '-o',  outBaseDir + '/print/printConfig.json', 
        '-s', 'https://github.com/qwc-services/qwc-print-service/raw/master/schemas/qwc-print-service.json'
        ]
}

task dServJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/data-service/template.json',
        '-o',  outBaseDir + '/dserv/dataConfig.json', 
        '-s', 'https://github.com/qwc-services/qwc-data-service/raw/master/schemas/qwc-data-service.json'
        ]
}

task repJson(type:Exec){
    commandLine baseCmd + [
        '-t',  inBaseDir + '/document-service/template.json',
        '-o',  outBaseDir + '/report/documentConf.json', 
        '-s', 'https://github.com/qwc-services/qwc-document-service/raw/master/schemas/qwc-document-service.json'
        ]
}



task up(type:Exec){
    dependsOn down
    dependsOn repJson
    commandLine 'docker-compose','up'
}